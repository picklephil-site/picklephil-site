<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Brine & Sign | Pickle Phil Guestbook</title>
<link rel="icon" href="favicon.svg">
<style>
  :root{ --bg:#145a32; --bg2:#2ecc71; --text:#f5f5f5; --btn:#f5f5f5; --btnText:#145a32; --radius:14px; --shadow:0 10px 35px rgba(0,0,0,.35); --panel-a:rgba(46,204,113,.20); --panel-b:rgba(46,204,113,.12); }
  *{box-sizing:border-box}
  body{ margin:0; font-family:Segoe UI,Tahoma,sans-serif; color:var(--text); background:radial-gradient(circle at top left,var(--bg2) 0%,var(--bg) 100%); min-height:100vh; display:flex; align-items:flex-start; justify-content:center; }
  .wrap{width:min(840px,100%); padding:22px}
  h1{margin:6px 0 10px; text-align:center}
  .btn{color:var(--btnText); background:var(--btn); text-decoration:none; padding:10px 16px; border-radius:12px; font-weight:700; transition:.2s; margin:6px; display:inline-block; box-shadow:var(--shadow)}
  .btn:hover{filter:brightness(.95); transform:translateY(-1px)}
  .card{background:linear-gradient(180deg,var(--panel-a),var(--panel-b)); border:1px solid rgba(255,255,255,.18); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); text-align:left}
  .meta{opacity:.95}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .guest-form input, .guest-form textarea{width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.10); color:#fff; outline:none}
  .guest-form textarea{resize:vertical; min-height:100px}
  .guest-list{margin-top:14px; display:flex; flex-direction:column; gap:10px}
  .guest-item{background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.16); padding:10px 12px; border-radius:10px}
  a,a:visited,a:hover,a:active{color:var(--text); text-decoration:none}
</style>
</head>
<body>
  <div class="wrap">
    <p><a class="btn" href="/">‚¨Ö Back to The Jar</a></p>
    <h1>üìù Brine &amp; Sign</h1>
    <p class="meta" style="text-align:center">Say hi and leave a crunchy note! Entries are saved and shown below.</p>

    <div class="card" style="margin-top:16px;">
      <form id="guestbook" class="guest-form" autocomplete="on">
        <input type="text" name="company" style="display:none">
        <div class="row">
          <input name="name" placeholder="Your name" required maxlength="60">
          <input name="email" type="email" placeholder="Email (optional)" maxlength="120">
        </div>
        <textarea name="message" placeholder="Your message‚Ä¶" required maxlength="1000"></textarea>
        <div class="row" style="justify-content:flex-end">
          <button class="btn" type="submit">Sign the Jar</button>
        </div>
      </form>

      <div id="guest-list" class="guest-list" aria-live="polite"></div>
      <p class="meta" id="status" style="margin-top:10px"></p>
    </div>
  </div>

<script>
const API = "/api/guestbook";
function fmt(ts){ const d=new Date(ts); return d.toLocaleString(); }
function el(tag, html, cls){ const e=document.createElement(tag); if(cls) e.className=cls; e.innerHTML=html; return e; }
function renderEntry(e){ const name=e.name.replace(/[<>]/g,''); const msg=e.message.replace(/[<>]/g,''); const when=fmt(e.ts); return el('div', `<b>${name}</b> <span class="meta">¬∑ ${when}</span><div>${msg}</div>`, 'guest-item'); }
async function loadEntries(){
  const list=document.getElementById('guest-list'); list.innerHTML='<div class="meta">Loading entries‚Ä¶</div>';
  try{
    const r=await fetch(API); const j=await r.json(); list.innerHTML='';
    if(!j || !j.entries || j.entries.length===0){ list.innerHTML='<div class="meta">No entries yet. Be the first to sign the jar!</div>'; return; }
    j.entries.forEach(e=> list.appendChild(renderEntry(e)));
  }catch{ list.innerHTML='<div class="meta">Could not load entries.</div>'; }
}
document.getElementById('guestbook').addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  const fd=new FormData(ev.target); if(fd.get('company')) return;
  const payload={ name:(fd.get('name')||'Someone').toString(), email:(fd.get('email')||'').toString(), message:(fd.get('message')||'').toString() };
  document.getElementById('status').textContent='Submitting‚Ä¶';
  try{
    const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    if(!r.ok) throw 0;
    ev.target.reset(); document.getElementById('status').textContent='Thanks for signing!'; await loadEntries();
  }catch{ document.getElementById('status').textContent='Oops‚Äîcould not submit right now.'; }
});
loadEntries();
</script>
</body>
</html>
