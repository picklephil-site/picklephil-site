<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ü•í Brine & Sign Guestbook</title>
  <link rel="icon" href="/img/pickle-jar-icon.png" />
  <style>
    :root{ --bg:#145a32; --bg2:#2ecc71; --text:#f5f5f5; --panel:rgba(255,255,255,.1); --radius:12px; --shadow:0 10px 30px rgba(0,0,0,.35); }
    *{box-sizing:border-box}
    body{ font-family: 'Segoe UI', Tahoma, sans-serif; margin:0; color:var(--text);
          background: radial-gradient(circle at top left, var(--bg2) 0%, var(--bg) 100%); }
    .wrap{ max-width: 760px; margin: 0 auto; padding: 22px; text-align:center; }
    h1{ margin: 8px 0 14px; }
    .card{ background:var(--panel); border:1px solid rgba(255,255,255,.14); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); }
    label{ display:block; text-align:left; margin:8px 0 6px; }
    input, textarea{ width:100%; border:1px solid rgba(255,255,255,.25); border-radius:10px; padding:10px 12px; background:#fff; color:#0f2d18; font-size:1rem; }
    textarea{ min-height:110px; resize:vertical; }
    .row{ margin-top:10px; display:flex; gap:10px; justify-content:flex-start; }
    .btn{ background:#f5f5f5; color:#145a32; padding:10px 16px; border-radius:12px; font-weight:800; border:none; cursor:pointer; }
    .entries{ margin-top:18px; text-align:left; }
    .entry{ background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.16); border-radius:12px; padding:10px 12px; margin:8px 0; }
    .entry small{ opacity:.9 }
    a{ color:var(--text); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ü´ô Brine &amp; Sign Guestbook</h1>
    <p>Leave your crunchy mark in the jar ‚Äî entries are saved permanently.</p>

    <div class="card">
      <form id="gb-form">
        <label for="name">Name</label>
        <input id="name" name="name" placeholder="Pickle Pal" />

        <label for="message">Message</label>
        <textarea id="message" name="message" placeholder="Stay crunchy!"></textarea>

        <div class="row">
          <button class="btn" type="submit">‚úçÔ∏è Sign the Jar</button>
          <a class="btn" href="/index.html">üè† Back to the Jar</a>
        </div>
      </form>
    </div>

    <h2 style="margin:20px 0 8px;">Latest Signatures</h2>
    <div id="gb-list" class="entries"></div>
  </div>

  <script>
    const API = "https://guestbook-api.philliphinshaw.workers.dev/entries";

    function esc(s){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

    async function loadEntries(){
      const r = await fetch(API);
      const rows = await r.json();
      const list = document.getElementById('gb-list');
      if(!Array.isArray(rows) || rows.length === 0){
        list.innerHTML = '<p>No entries yet ‚Äî be the first!</p>';
        return;
      }
      list.innerHTML = rows.map(x => `
        <div class="entry">
          <strong>${esc(x.name || 'Anonymous Pickle')}</strong>
          <div>${esc(x.message || '')}</div>
          <small>${new Date(x.ts || Date.now()).toLocaleString()}</small>
        </div>
      `).join('');
    }

    document.getElementById('gb-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const message = document.getElementById('message').value.trim();
      if(!message){ alert('Please write a message.'); return; }
      const r = await fetch(API, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ name, message })
      });
      if(!r.ok){ alert('Could not save your entry.'); return; }
      e.target.reset();
      loadEntries();
    });

    loadEntries();
  </script>
</body>
</html>
